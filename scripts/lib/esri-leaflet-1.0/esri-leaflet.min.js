(function(d){"function"===typeof define&&define.amd?define(["leaflet"],function(e){return d(e)}):"object"===typeof module&&"object"===typeof module.exports&&(module.exports=d(require("leaflet")));"undefined"!==typeof window&&window.L&&d(window.L)})(function(d){var e={VERSION:"1.0.0",Layers:{},Services:{},Controls:{},Tasks:{},Util:{},Support:{CORS:!!(window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest),pointerEvents:""===document.documentElement.style.pointerEvents}};"undefined"!=typeof window&&
window.L&&(window.L.esri=e);(function(a){function b(a){var c={},b;for(b in a)a.hasOwnProperty(b)&&(c[b]=a[b]);return c}function c(a){var c;a:{c=a[0];for(var b=0;b<c.length;b++)if(c[b]!==a[a.length-1][b]){c=!1;break a}c=!0}return c||a.push(a[0]),a}function f(a){var c,b=0,f=0,k=a.length,g=a[f];for(f;k-1>f;f++)c=a[f+1],b+=(c[0]-g[0])*(c[1]+g[1]),g=c;return 0<=b}function k(a,c){for(var b=0;b<a.length-1;b++)for(var f=0;f<c.length-1;f++){var k;a:{var g=a[b],d=a[b+1],e=c[f],h=c[f+1],p=(h[0]-e[0])*(g[1]-
e[1])-(h[1]-e[1])*(g[0]-e[0]);k=(d[0]-g[0])*(g[1]-e[1])-(d[1]-g[1])*(g[0]-e[0]);g=(h[1]-e[1])*(d[0]-g[0])-(h[0]-e[0])*(d[1]-g[1]);if(0!==g&&(p/=g,k/=g,0<=p&&1>=p&&0<=k&&1>=k)){k=!0;break a}k=!1}if(k)return!0}return!1}function g(a){var b=[];a=a.slice(0);var k=c(a.shift().slice(0));if(4<=k.length)for(f(k)||k.reverse(),b.push(k),k=0;k<a.length;k++){var g=c(a[k].slice(0));4<=g.length&&(f(g)&&g.reverse(),b.push(g))}return b}var e=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||
window.msRequestAnimationFrame||function(a){return window.setTimeout(a,1E3/60)};a.Util.extentToBounds=function(a){var c=new d.LatLng(a.ymin,a.xmin);a=new d.LatLng(a.ymax,a.xmax);return new d.LatLngBounds(c,a)};a.Util.boundsToExtent=function(a){return a=d.latLngBounds(a),{xmin:a.getSouthWest().lng,ymin:a.getSouthWest().lat,xmax:a.getNorthEast().lng,ymax:a.getNorthEast().lat,spatialReference:{wkid:4326}}};a.Util.arcgisToGeojson=function(g,e){var d={};"number"==typeof g.x&&"number"==typeof g.y&&(d.type=
"Point",d.coordinates=[g.x,g.y]);g.points&&(d.type="MultiPoint",d.coordinates=g.points.slice(0));g.paths&&(1===g.paths.length?(d.type="LineString",d.coordinates=g.paths[0].slice(0)):(d.type="MultiLineString",d.coordinates=g.paths.slice(0)));if(g.rings){var h=g.rings.slice(0),x,q,d=[],v=[];for(q=0;q<h.length;q++){var r=c(h[q].slice(0));4>r.length||(f(r)?d.push([r]):v.push(r))}for(r=[];v.length;){q=v.pop();for(var y=!1,h=d.length-1;0<=h;h--){for(var p=x=d[h][0],t=q,C=k(p,t),t=t[0],A=!1,w=-1,B=p.length,
z=B-1;++w<B;z=w)(p[w][1]<=t[1]&&t[1]<p[z][1]||p[z][1]<=t[1]&&t[1]<p[w][1])&&t[0]<(p[z][0]-p[w][0])*(t[1]-p[w][1])/(p[z][1]-p[w][1])+p[w][0]&&(A=!A);p=A;if(!C&&p){d[h].push(q);y=!0;break}}y||r.push(q)}for(;r.length;){q=r.pop();v=!1;for(h=d.length-1;0<=h;h--)if(x=d[h][0],k(x,q)){d[h].push(q);v=!0;break}v||d.push([q.reverse()])}d=1===d.length?{type:"Polygon",coordinates:d[0]}:{type:"MultiPolygon",coordinates:d}}return(g.geometry||g.attributes)&&(d.type="Feature",d.geometry=g.geometry?a.Util.arcgisToGeojson(g.geometry):
null,d.properties=g.attributes?b(g.attributes):null,g.attributes&&(d.id=g.attributes[e]||g.attributes.OBJECTID||g.attributes.FID)),d};a.Util.geojsonToArcGIS=function(c,f){f=f||"OBJECTID";var k;k={wkid:4326};var d={};switch(c.type){case "Point":d.x=c.coordinates[0];d.y=c.coordinates[1];d.spatialReference=k;break;case "MultiPoint":d.points=c.coordinates.slice(0);d.spatialReference=k;break;case "LineString":d.paths=[c.coordinates.slice(0)];d.spatialReference=k;break;case "MultiLineString":d.paths=c.coordinates.slice(0);
d.spatialReference=k;break;case "Polygon":d.rings=g(c.coordinates.slice(0));d.spatialReference=k;break;case "MultiPolygon":for(var e=d,h=c.coordinates.slice(0),v=[],r=0;r<h.length;r++)for(var y=g(h[r]),p=y.length-1;0<=p;p--){var t=y[p].slice(0);v.push(t)}e.rings=v;d.spatialReference=k;break;case "Feature":c.geometry&&(d.geometry=a.Util.geojsonToArcGIS(c.geometry,f));d.attributes=c.properties?b(c.properties):{};c.id&&(d.attributes[f]=c.id);break;case "FeatureCollection":d=[];for(k=0;k<c.features.length;k++)d.push(a.Util.geojsonToArcGIS(c.features[k],
f));break;case "GeometryCollection":for(d=[],k=0;k<c.geometries.length;k++)d.push(a.Util.geojsonToArcGIS(c.geometries[k],f))}return d};a.Util.responseToFeatureCollection=function(c,b){var f;if(b)f=b;else if(c.objectIdFieldName)f=c.objectIdFieldName;else if(c.fields)for(var k=0;k<=c.fields.length-1;k++){if("esriFieldTypeOID"===c.fields[k].type){f=c.fields[k].name;break}}else f="OBJECTID";var k={type:"FeatureCollection",features:[]},d=c.features||c.results;if(d.length)for(var g=d.length-1;0<=g;g--)k.features.push(a.Util.arcgisToGeojson(d[g],
f));return k};a.Util.cleanUrl=function(a){return a=a.replace(/^\s+|\s+$|\A\s+|\s+\z/g,""),"/"!==a[a.length-1]&&(a+="/"),a};a.Util.isArcgisOnline=function(a){return/\.arcgis\.com.*?FeatureServer/g.test(a)};a.Util.geojsonTypeToArcGIS=function(a){var c;switch(a){case "Point":c="esriGeometryPoint";break;case "MultiPoint":c="esriGeometryMultipoint";break;case "LineString":c="esriGeometryPolyline";break;case "MultiLineString":c="esriGeometryPolyline";break;case "Polygon":c="esriGeometryPolygon";break;case "MultiPolygon":c=
"esriGeometryPolygon"}return c};a.Util.requestAnimationFrame=d.Util.bind(e,window);a.Util.warn=function(a){console&&console.warn&&console.warn(a)}})(e);(function(a){function b(a){var c="";a.f=a.f||"json";for(var b in a)if(a.hasOwnProperty(b)){var f;f=a[b];var d=Object.prototype.toString.call(f);c.length&&(c+="&");f="[object Array]"===d?"[object Object]"===Object.prototype.toString.call(f[0])?JSON.stringify(f):f.join(","):"[object Object]"===d?JSON.stringify(f):"[object Date]"===d?f.valueOf():f;c+=
encodeURIComponent(b)+"="+encodeURIComponent(f)}return c}function c(a,c){var b=new XMLHttpRequest;return b.onerror=function(f){b.onreadystatechange=d.Util.falseFn;a.call(c,{error:{code:500,message:"XMLHttpRequest error"}},null)},b.onreadystatechange=function(){var f,e;if(4===b.readyState){try{f=JSON.parse(b.responseText)}catch(n){f=null,e={code:500,message:"Could not parse response as JSON. This could also be caused by a CORS or XMLHttpRequest error."}}!e&&f.error&&(e=f.error,f=null);b.onerror=d.Util.falseFn;
a.call(c,e,f)}},b}var f=0;window._EsriLeafletCallbacks={};a.Request={request:function(f,g,e,l){var m=b(g),n=c(e,l),u=(f+"?"+m).length;if(2E3>=u&&d.esri.Support.CORS)n.open("GET",f+"?"+m),n.send(null);else{if(!(2E3<u&&d.esri.Support.CORS))return 2E3>=u&&!d.esri.Support.CORS?d.esri.Request.get.JSONP(f,g,e,l):void a.Util.warn("a request to "+f+" was longer then 2000 characters and this browser cannot make a cross-domain post request. Please use a proxy http://esri.github.io/esri-leaflet/api-reference/request.html");
n.open("POST",f);n.setRequestHeader("Content-Type","application/x-www-form-urlencoded");n.send(m)}return n},post:{XMLHTTP:function(a,f,d,e){d=c(d,e);return d.open("POST",a),d.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),d.send(b(f)),d}},get:{CORS:function(a,f,d,e){d=c(d,e);return d.open("GET",a+"?"+b(f),!0),d.send(null),d},JSONP:function(a,c,e,l){var m="c"+f;c.callback="window._EsriLeafletCallbacks."+m;var n=d.DomUtil.create("script",null,document.body);return n.type="text/javascript",
n.src=a+"?"+b(c),n.id=m,window._EsriLeafletCallbacks[m]=function(a){if(!0!==window._EsriLeafletCallbacks[m]){var c,b=Object.prototype.toString.call(a);"[object Object]"!==b&&"[object Array]"!==b&&(c={error:{code:500,message:"Expected array or object as JSONP response"}},a=null);!c&&a.error&&(c=a,a=null);e.call(l,c,a);window._EsriLeafletCallbacks[m]=!0}},f++,{id:m,url:n.src,abort:function(){window._EsriLeafletCallbacks._callback[m]({code:0,message:"Request aborted."})}}}}};a.get=a.Support.CORS?a.Request.get.CORS:
a.Request.get.JSONP;a.post=a.Request.post.XMLHTTP;a.request=a.Request.request})(e);e.Services.Service=d.Class.extend({includes:d.Mixin.Events,options:{proxy:!1,useCors:e.Support.CORS},initialize:function(a){a=a||{};this._requestQueue=[];this._authenticating=!1;d.Util.setOptions(this,a);this.options.url=e.Util.cleanUrl(this.options.url)},get:function(a,b,c,f){return this._request("get",a,b,c,f)},post:function(a,b,c,f){return this._request("post",a,b,c,f)},request:function(a,b,c,f){return this._request("request",
a,b,c,f)},metadata:function(a,b){return this._request("get","",{},a,b)},authenticate:function(a){return this._authenticating=!1,this.options.token=a,this._runQueue(),this},_request:function(a,b,c,f,d){this.fire("requeststart",{url:this.options.url+b,params:c,method:a});var g=this._createServiceCallback(a,b,c,f,d);if(this.options.token&&(c.token=this.options.token),this._authenticating)return void this._requestQueue.push([a,b,c,f,d]);b=this.options.proxy?this.options.proxy+"?"+this.options.url+b:this.options.url+
b;return"get"!==a&&"request"!==a||this.options.useCors?e[a](b,c,g):e.Request.get.JSONP(b,c,g)},_createServiceCallback:function(a,b,c,f,k){return d.Util.bind(function(g,e){!g||499!==g.code&&498!==g.code||(this._authenticating=!0,this._requestQueue.push([a,b,c,f,k]),this.fire("authenticationrequired",{authenticate:d.Util.bind(this.authenticate,this)}),g.authenticate=d.Util.bind(this.authenticate,this));f.call(k,g,e);g?this.fire("requesterror",{url:this.options.url+b,params:c,message:g.message,code:g.code,
method:a}):this.fire("requestsuccess",{url:this.options.url+b,params:c,response:e,method:a});this.fire("requestend",{url:this.options.url+b,params:c,method:a})},this)},_runQueue:function(){for(var a=this._requestQueue.length-1;0<=a;a--){var b=this._requestQueue[a];this[b.shift()].apply(this,b)}this._requestQueue=[]}});e.Services.service=function(a){return new e.Services.Service(a)};e.Services.FeatureLayerService=e.Services.Service.extend({options:{idAttribute:"OBJECTID"},query:function(){return new e.Tasks.Query(this)},
addFeature:function(a,b,c){return delete a.id,a=e.Util.geojsonToArcGIS(a),this.post("addFeatures",{features:[a]},function(a,d){var g=d&&d.addResults?d.addResults[0]:void 0;b&&b.call(c,a||d.addResults[0].error,g)},c)},updateFeature:function(a,b,c){return a=e.Util.geojsonToArcGIS(a,this.options.idAttribute),this.post("updateFeatures",{features:[a]},function(a,d){var g=d&&d.updateResults?d.updateResults[0]:void 0;b&&b.call(c,a||d.updateResults[0].error,g)},c)},deleteFeature:function(a,b,c){return this.post("deleteFeatures",
{objectIds:a},function(a,d){var g=d&&d.deleteResults?d.deleteResults[0]:void 0;b&&b.call(c,a||d.deleteResults[0].error,g)},c)},deleteFeatures:function(a,b,c){return this.post("deleteFeatures",{objectIds:a},function(a,d){var g=d&&d.deleteResults?d.deleteResults:void 0;b&&b.call(c,a||d.deleteResults[0].error,g)},c)}});e.Services.featureLayerService=function(a){return new e.Services.FeatureLayerService(a)};e.Services.MapService=e.Services.Service.extend({identify:function(){return new e.Tasks.identifyFeatures(this)},
find:function(){return new e.Tasks.Find(this)},query:function(){return new e.Tasks.Query(this)}});e.Services.mapService=function(a){return new e.Services.MapService(a)};e.Services.ImageService=e.Services.Service.extend({query:function(){return new e.Tasks.Query(this)},identify:function(){return new e.Tasks.IdentifyImage(this)}});e.Services.imageService=function(a){return new e.Services.ImageService(a)};e.Tasks.Task=d.Class.extend({options:{proxy:!1,useCors:e.Support.CORS},generateSetter:function(a,
b){return d.Util.bind(function(c){return this.params[a]=c,this},b)},initialize:function(a){if(a.request&&a.options?(this._service=a,d.Util.setOptions(this,a.options)):(d.Util.setOptions(this,a),this.options.url=d.esri.Util.cleanUrl(a.url)),this.params=d.Util.extend({},this.params||{}),this.setters)for(var b in this.setters)this[b]=this.generateSetter(this.setters[b],this)},token:function(a){return this._service?this._service.authenticate(a):this.params.token=a,this},request:function(a,b){return this._service?
this._service.request(this.path,this.params,a,b):this._request("request",this.path,this.params,a,b)},_request:function(a,b,c,f,d){b=this.options.proxy?this.options.proxy+"?"+this.options.url+b:this.options.url+b;return"get"!==a&&"request"!==a||this.options.useCors?e[a](b,c,f,d):e.Request.get.JSONP(b,c,f,d)}});e.Tasks.Query=e.Tasks.Task.extend({setters:{offset:"offset",limit:"limit",fields:"outFields",precision:"geometryPrecision",featureIds:"objectIds",returnGeometry:"returnGeometry",token:"token"},
path:"query",params:{returnGeometry:!0,where:"1=1",outSr:4326,outFields:"*"},within:function(a){return this._setGeometry(a),this.params.spatialRel="esriSpatialRelContains",this},intersects:function(a){return this._setGeometry(a),this.params.spatialRel="esriSpatialRelIntersects",this},contains:function(a){return this._setGeometry(a),this.params.spatialRel="esriSpatialRelWithin",this},overlaps:function(a){return this._setGeometry(a),this.params.spatialRel="esriSpatialRelOverlaps",this},nearby:function(a,
b){return a=d.latLng(a),this.params.geometry=[a.lng,a.lat],this.params.geometryType="esriGeometryPoint",this.params.spatialRel="esriSpatialRelIntersects",this.params.units="esriSRUnit_Meter",this.params.distance=b,this.params.inSr=4326,this},where:function(a){return this.params.where=a,this},between:function(a,b){return this.params.time=[a.valueOf(),b.valueOf()],this},simplify:function(a,b){var c=Math.abs(a.getBounds().getWest()-a.getBounds().getEast());return this.params.maxAllowableOffset=c/a.getSize().y*
b,this},orderBy:function(a,b){return b=b||"ASC",this.params.orderByFields=this.params.orderByFields?this.params.orderByFields+",":"",this.params.orderByFields+=[a,b].join(" "),this},run:function(a,b){return this._cleanParams(),e.Util.isArcgisOnline(this.options.url)?(this.params.f="geojson",this.request(function(c,f){this._trapSQLerrors(c);a.call(b,c,f,f)},this)):this.request(function(c,f){this._trapSQLerrors(c);a.call(b,c,f&&e.Util.responseToFeatureCollection(f),f)},this)},count:function(a,b){return this._cleanParams(),
this.params.returnCountOnly=!0,this.request(function(c,b){a.call(this,c,b&&b.count,b)},b)},ids:function(a,b){return this._cleanParams(),this.params.returnIdsOnly=!0,this.request(function(c,b){a.call(this,c,b&&b.objectIds,b)},b)},bounds:function(a,b){return this._cleanParams(),this.params.returnExtentOnly=!0,this.request(function(c,f){a.call(b,c,f&&f.extent&&e.Util.extentToBounds(f.extent),f)},b)},pixelSize:function(a){return a=d.point(a),this.params.pixelSize=[a.x,a.y],this},layer:function(a){return this.path=
a+"/query",this},_trapSQLerrors:function(a){a&&"400"===a.code&&e.Util.warn("one common syntax error in query requests is encasing string values in double quotes instead of single quotes")},_cleanParams:function(){delete this.params.returnIdsOnly;delete this.params.returnExtentOnly;delete this.params.returnCountOnly},_setGeometry:function(a){return this.params.inSr=4326,a instanceof d.LatLngBounds?(this.params.geometry=e.Util.boundsToExtent(a),void(this.params.geometryType="esriGeometryEnvelope")):
(a.getLatLng&&(a=a.getLatLng()),a instanceof d.LatLng&&(a={type:"Point",coordinates:[a.lng,a.lat]}),a instanceof d.GeoJSON&&(a=a.getLayers()[0].feature.geometry,this.params.geometry=e.Util.geojsonToArcGIS(a),this.params.geometryType=e.Util.geojsonTypeToArcGIS(a.type)),a.toGeoJSON&&(a=a.toGeoJSON()),"Feature"===a.type&&(a=a.geometry),"Point"===a.type||"LineString"===a.type||"Polygon"===a.type?(this.params.geometry=e.Util.geojsonToArcGIS(a),void(this.params.geometryType=e.Util.geojsonTypeToArcGIS(a.type))):
void e.Util.warn("invalid geometry passed to spatial query. Should be an L.LatLng, L.LatLngBounds or L.Marker or a GeoJSON Point Line or Polygon object"))}});e.Tasks.query=function(a){return new e.Tasks.Query(a)};e.Tasks.Find=e.Tasks.Task.extend({setters:{contains:"contains",text:"searchText",fields:"searchFields",spatialReference:"sr",sr:"sr",layers:"layers",returnGeometry:"returnGeometry",maxAllowableOffset:"maxAllowableOffset",precision:"geometryPrecision",dynamicLayers:"dynamicLayers",returnZ:"returnZ",
returnM:"returnM",gdbVersion:"gdbVersion",token:"token"},path:"find",params:{sr:4326,contains:!0,returnGeometry:!0,returnZ:!0,returnM:!1},layerDefs:function(a,b){return this.params.layerDefs=this.params.layerDefs?this.params.layerDefs+";":"",this.params.layerDefs+=[a,b].join(":"),this},simplify:function(a,b){var c=Math.abs(a.getBounds().getWest()-a.getBounds().getEast());return this.params.maxAllowableOffset=c/a.getSize().y*b,this},run:function(a,b){return this.request(function(c,f){a.call(b,c,f&&
e.Util.responseToFeatureCollection(f),f)},b)}});e.Tasks.find=function(a){return new e.Tasks.Find(a)};e.Tasks.Identify=e.Tasks.Task.extend({path:"identify",between:function(a,b){return this.params.time=[a.valueOf(),b.valueOf()],this}});e.Tasks.IdentifyImage=e.Tasks.Identify.extend({setters:{setMosaicRule:"mosaicRule",setRenderingRule:"renderingRule",setPixelSize:"pixelSize",returnCatalogItems:"returnCatalogItems",returnGeometry:"returnGeometry"},params:{returnGeometry:!1},at:function(a){return a=d.latLng(a),
this.params.geometry=JSON.stringify({x:a.lng,y:a.lat,spatialReference:{wkid:4326}}),this.params.geometryType="esriGeometryPoint",this},getMosaicRule:function(){return this.params.mosaicRule},getRenderingRule:function(){return this.params.renderingRule},getPixelSize:function(){return this.params.pixelSize},run:function(a,b){return this.request(function(c,f){a.call(b,c,f&&this._responseToGeoJSON(f),f)},this)},_responseToGeoJSON:function(a){var b=a.location,c=a.catalogItems,f=a.catalogItemVisibilities,
b={pixel:{type:"Feature",geometry:{type:"Point",coordinates:[b.x,b.y]},crs:{type:"EPSG",properties:{code:b.spatialReference.wkid}},properties:{OBJECTID:a.objectId,name:a.name,value:a.value},id:a.objectId}};if(a.properties&&a.properties.Values&&(b.pixel.properties.values=a.properties.Values),c&&c.features&&(b.catalogItems=e.Util.responseToFeatureCollection(c),f&&f.length===b.catalogItems.features.length))for(a=f.length-1;0<=a;a--)b.catalogItems.features[a].properties.catalogItemVisibility=f[a];return b}});
e.Tasks.identifyImage=function(a){return new e.Tasks.IdentifyImage(a)};e.Tasks.IdentifyFeatures=e.Tasks.Identify.extend({setters:{layers:"layers",precision:"geometryPrecision",tolerance:"tolerance",returnGeometry:"returnGeometry"},params:{sr:4326,layers:"all",tolerance:3,returnGeometry:!0},on:function(a){var b=e.Util.boundsToExtent(a.getBounds());a=a.getSize();return this.params.imageDisplay=[a.x,a.y,96],this.params.mapExtent=[b.xmin,b.ymin,b.xmax,b.ymax],this},at:function(a){return a=d.latLng(a),
this.params.geometry=[a.lng,a.lat],this.params.geometryType="esriGeometryPoint",this},layerDef:function(a,b){return this.params.layerDefs=this.params.layerDefs?this.params.layerDefs+";":"",this.params.layerDefs+=[a,b].join(":"),this},simplify:function(a,b){var c=Math.abs(a.getBounds().getWest()-a.getBounds().getEast());return this.params.maxAllowableOffset=c/a.getSize().y*(1-b),this},run:function(a,b){return this.request(function(c,f){if(c)return void a.call(b,c,void 0,f);var d=e.Util.responseToFeatureCollection(f);
f.results=f.results.reverse();for(var g=0;g<d.features.length;g++)d.features[g].layerId=f.results[g].layerId;a.call(b,void 0,d,f)})}});e.Tasks.identifyFeatures=function(a){return new e.Tasks.IdentifyFeatures(a)};(function(a){var b="https:"!==window.location.protocol?"http:":"https:";a.Layers.BasemapLayer=d.TileLayer.extend({statics:{TILES:{Streets:{urlTemplate:b+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}",attributionUrl:"https://static.arcgis.com/attribution/World_Street_Map",
options:{hideLogo:!1,logoPosition:"bottomright",minZoom:1,maxZoom:19,subdomains:["server","services"],attribution:"Esri"}},Topographic:{urlTemplate:b+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}",attributionUrl:"https://static.arcgis.com/attribution/World_Topo_Map",options:{hideLogo:!1,logoPosition:"bottomright",minZoom:1,maxZoom:19,subdomains:["server","services"],attribution:"Esri"}},Oceans:{urlTemplate:b+"//{s}.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer/tile/{z}/{y}/{x}",
attributionUrl:"https://static.arcgis.com/attribution/Ocean_Basemap",options:{hideLogo:!1,logoPosition:"bottomright",minZoom:1,maxZoom:16,subdomains:["server","services"],attribution:"Esri"}},OceansLabels:{urlTemplate:b+"//{s}.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer/tile/{z}/{y}/{x}",options:{hideLogo:!0,logoPosition:"bottomright",minZoom:1,maxZoom:16,subdomains:["server","services"]}},NationalGeographic:{urlTemplate:b+"//{s}.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer/tile/{z}/{y}/{x}",
options:{hideLogo:!1,logoPosition:"bottomright",minZoom:1,maxZoom:16,subdomains:["server","services"],attribution:"Esri"}},DarkGray:{urlTemplate:b+"//{s}.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Base/MapServer/tile/{z}/{y}/{x}",options:{hideLogo:!1,logoPosition:"bottomright",minZoom:1,maxZoom:16,subdomains:["server","services"],attribution:"Esri, DeLorme, HERE"}},DarkGrayLabels:{urlTemplate:b+"//{s}.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Reference/MapServer/tile/{z}/{y}/{x}",
options:{hideLogo:!0,logoPosition:"bottomright",minZoom:1,maxZoom:16,subdomains:["server","services"]}},Gray:{urlTemplate:b+"//{s}.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer/tile/{z}/{y}/{x}",options:{hideLogo:!1,logoPosition:"bottomright",minZoom:1,maxZoom:16,subdomains:["server","services"],attribution:"Esri, NAVTEQ, DeLorme"}},GrayLabels:{urlTemplate:b+"//{s}.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Reference/MapServer/tile/{z}/{y}/{x}",options:{hideLogo:!0,
logoPosition:"bottomright",minZoom:1,maxZoom:16,subdomains:["server","services"]}},Imagery:{urlTemplate:b+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",options:{hideLogo:!1,logoPosition:"bottomright",minZoom:1,maxZoom:19,subdomains:["server","services"],attribution:"Esri, DigitalGlobe, GeoEye, i-cubed, USDA, USGS, AEX, Getmapping, Aerogrid, IGN, IGP, swisstopo, and the GIS User Community"}},ImageryLabels:{urlTemplate:b+"//{s}.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer/tile/{z}/{y}/{x}",
options:{hideLogo:!0,logoPosition:"bottomright",minZoom:1,maxZoom:19,subdomains:["server","services"]}},ImageryTransportation:{urlTemplate:b+"//{s}.arcgisonline.com/ArcGIS/rest/services/Reference/World_Transportation/MapServer/tile/{z}/{y}/{x}",options:{hideLogo:!0,logoPosition:"bottomright",minZoom:1,maxZoom:19,subdomains:["server","services"]}},ShadedRelief:{urlTemplate:b+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Shaded_Relief/MapServer/tile/{z}/{y}/{x}",options:{hideLogo:!1,logoPosition:"bottomright",
minZoom:1,maxZoom:13,subdomains:["server","services"],attribution:"Esri, NAVTEQ, DeLorme"}},ShadedReliefLabels:{urlTemplate:b+"//{s}.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places_Alternate/MapServer/tile/{z}/{y}/{x}",options:{hideLogo:!0,logoPosition:"bottomright",minZoom:1,maxZoom:12,subdomains:["server","services"]}},Terrain:{urlTemplate:b+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer/tile/{z}/{y}/{x}",options:{hideLogo:!1,logoPosition:"bottomright",
minZoom:1,maxZoom:13,subdomains:["server","services"],attribution:"Esri, USGS, NOAA"}},TerrainLabels:{urlTemplate:b+"//{s}.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer/tile/{z}/{y}/{x}",options:{hideLogo:!0,logoPosition:"bottomright",minZoom:1,maxZoom:13,subdomains:["server","services"]}}}},initialize:function(c,b){var k;if("object"==typeof c&&c.urlTemplate&&c.options)k=c;else{if("string"!=typeof c||!a.BasemapLayer.TILES[c])throw Error('L.esri.BasemapLayer: Invalid parameter. Use one of "Streets", "Topographic", "Oceans", "OceansLabels", "NationalGeographic", "Gray", "GrayLabels", "DarkGray", "DarkGrayLabels", "Imagery", "ImageryLabels", "ImageryTransportation", "ShadedRelief", "ShadedReliefLabels", "Terrain" or "TerrainLabels"');
k=a.BasemapLayer.TILES[c]}var g=d.Util.extend(k.options,b);d.TileLayer.prototype.initialize.call(this,k.urlTemplate,d.Util.setOptions(this,g));k.attributionUrl&&this._getAttributionData(k.attributionUrl);this._logo=new a.Controls.Logo({position:this.options.logoPosition})},onAdd:function(a){this.options.hideLogo||a._hasEsriLogo||(this._logo.addTo(a),a._hasEsriLogo=!0);d.TileLayer.prototype.onAdd.call(this,a);a.on("moveend",this._updateMapAttribution,this)},onRemove:function(a){this._logo&&this._logo._container&&
(a.removeControl(this._logo),a._hasEsriLogo=!1);d.TileLayer.prototype.onRemove.call(this,a);a.off("moveend",this._updateMapAttribution,this)},getAttribution:function(){return'<span class="esri-attributions" style="line-height:14px; vertical-align: -3px; text-overflow:ellipsis; white-space:nowrap; overflow:hidden; display:inline-block;">'+this.options.attribution+"</span>"},_getAttributionData:function(a){d.esri.Request.get.JSONP(a,{},d.Util.bind(function(a,c){this._attributions=[];for(var b=0;b<c.contributors.length;b++)for(var e=
c.contributors[b],l=0;l<e.coverageAreas.length;l++){var m=e.coverageAreas[l],n=new d.LatLng(m.bbox[0],m.bbox[1]),u=new d.LatLng(m.bbox[2],m.bbox[3]);this._attributions.push({attribution:e.attribution,score:m.score,bounds:new d.LatLngBounds(n,u),minZoom:m.zoomMin,maxZoom:m.zoomMax})}this._attributions.sort(function(a,c){return c.score-a.score});this._updateMapAttribution()},this))},_updateMapAttribution:function(){if(this._map&&this._map.attributionControl&&this._attributions){for(var a="",b=this._map.getBounds(),
d=this._map.getZoom(),e=0;e<this._attributions.length;e++){var h=this._attributions[e],l=h.attribution;!a.match(l)&&b.intersects(h.bounds)&&d>=h.minZoom&&d<=h.maxZoom&&(a+=", "+l)}a=a.substr(2);b=this._map.attributionControl._container.querySelector(".esri-attributions");b.innerHTML=a;b.style.maxWidth=.65*this._map.getSize().x+"px";this.fire("attributionupdated",{attribution:a})}}});a.BasemapLayer=a.Layers.BasemapLayer;a.Layers.basemapLayer=function(c,b){return new a.Layers.BasemapLayer(c,b)};a.basemapLayer=
function(c,b){return new a.Layers.BasemapLayer(c,b)}})(e);e.Layers.RasterLayer=d.Class.extend({includes:d.Mixin.Events,options:{opacity:1,position:"front",f:"image"},onAdd:function(a){if(this._map=a,this._update=d.Util.limitExecByInterval(this._update,this.options.updateInterval,this),a.options.crs&&a.options.crs.code){var b=a.options.crs.code.split(":")[1];this.options.bboxSR=b;this.options.imageSR=b}a.on("moveend",this._update,this);this._currentImage&&this._currentImage._bounds.equals(this._map.getBounds())?
a.addLayer(this._currentImage):this._currentImage&&(this._map.removeLayer(this._currentImage),this._currentImage=null);this._update();this._popup&&(this._map.on("click",this._getPopupData,this),this._map.on("dblclick",this._resetPopupState,this))},bindPopup:function(a,b){return this._shouldRenderPopup=!1,this._lastClick=!1,this._popup=d.popup(b),this._popupFunction=a,this._map&&(this._map.on("click",this._getPopupData,this),this._map.on("dblclick",this._resetPopupState,this)),this},unbindPopup:function(){return this._map&&
(this._map.closePopup(this._popup),this._map.off("click",this._getPopupData,this),this._map.off("dblclick",this._resetPopupState,this)),this._popup=!1,this},onRemove:function(a){this._currentImage&&this._map.removeLayer(this._currentImage);this._popup&&(this._map.off("click",this._getPopupData,this),this._map.off("dblclick",this._resetPopupState,this));this._map.off("moveend",this._update,this);this._map=null},addTo:function(a){return a.addLayer(this),this},removeFrom:function(a){return a.removeLayer(this),
this},bringToFront:function(){return this.options.position="front",this._currentImage&&this._currentImage.bringToFront(),this},bringToBack:function(){return this.options.position="back",this._currentImage&&this._currentImage.bringToBack(),this},getAttribution:function(){return this.options.attribution},getOpacity:function(){return this.options.opacity},setOpacity:function(a){return this.options.opacity=a,this._currentImage.setOpacity(a),this},getTimeRange:function(){return[this.options.from,this.options.to]},
setTimeRange:function(a,b){return this.options.from=a,this.options.to=b,this._update(),this},metadata:function(a,b){return this._service.metadata(a,b),this},authenticate:function(a){return this._service.authenticate(a),this},_renderImage:function(a,b){this._map&&((new d.ImageOverlay(a,b,{opacity:0})).addTo(this._map).once("load",function(a){a=a.target;var f=this._currentImage;a._bounds.equals(b)&&a._bounds.equals(this._map.getBounds())?(this._currentImage=a,"front"===this.options.position?this.bringToFront():
this.bringToBack(),this._map&&this._currentImage._map?this._currentImage.setOpacity(this.options.opacity):this._currentImage._map.removeLayer(this._currentImage),f&&this._map&&this._map.removeLayer(f),f&&f._map&&f._map.removeLayer(f)):this._map.removeLayer(a);this.fire("load",{bounds:b})},this),this.fire("loading",{bounds:b}))},_update:function(){if(this._map){var a=this._map.getZoom(),b=this._map.getBounds();this._animatingZoom||this._map._panTransition&&this._map._panTransition._inProgress||a>this.options.maxZoom||
a<this.options.minZoom||(a=this._buildExportParams(),this._requestExport(a,b))}},_renderPopup:function(a,b,c,f){(a=d.latLng(a),this._shouldRenderPopup&&this._lastClick.equals(a))&&(b=this._popupFunction(b,c,f))&&this._popup.setLatLng(a).setContent(b).openOn(this._map)},_resetPopupState:function(a){this._shouldRenderPopup=!1;this._lastClick=a.latlng},_propagateEvent:function(a){a=d.extend({layer:a.target,target:this},a);this.fire(a.type,a)}});e.Layers.DynamicMapLayer=e.Layers.RasterLayer.extend({options:{updateInterval:150,
layers:!1,layerDefs:!1,timeOptions:!1,format:"png24",transparent:!0,f:"json"},initialize:function(a){a.url=e.Util.cleanUrl(a.url);this._service=new e.Services.MapService(a);this._service.on("authenticationrequired requeststart requestend requesterror requestsuccess",this._propagateEvent,this);(a.proxy||a.token)&&"json"!==a.f&&(a.f="json");d.Util.setOptions(this,a)},getDynamicLayers:function(){return this.options.dynamicLayers},setDynamicLayers:function(a){return this.options.dynamicLayers=a,this._update(),
this},getLayers:function(){return this.options.layers},setLayers:function(a){return this.options.layers=a,this._update(),this},getLayerDefs:function(){return this.options.layerDefs},setLayerDefs:function(a){return this.options.layerDefs=a,this._update(),this},getTimeOptions:function(){return this.options.timeOptions},setTimeOptions:function(a){return this.options.timeOptions=a,this._update(),this},query:function(){return this._service.query()},identify:function(){return this._service.identify()},
find:function(){return this._service.find()},_getPopupData:function(a){var b=d.Util.bind(function(c,b,e){c||setTimeout(d.Util.bind(function(){this._renderPopup(a.latlng,c,b,e)},this),300)},this),c=this.identify().on(this._map).at(a.latlng);this.options.layers?c.layers("visible:"+this.options.layers.join(",")):c.layers("visible");c.run(b);this._shouldRenderPopup=!0;this._lastClick=a.latlng},_buildExportParams:function(){var a=this._map.getBounds(),b=this._map.getSize(),c=this._map.options.crs.project(a._northEast),
f=this._map.options.crs.project(a._southWest),d=this._map.latLngToLayerPoint(a._northEast),a=this._map.latLngToLayerPoint(a._southWest);(0<d.y||a.y<b.y)&&(b.y=a.y-d.y);b={bbox:[f.x,f.y,c.x,c.y].join(),size:b.x+","+b.y,dpi:96,format:this.options.format,transparent:this.options.transparent,bboxSR:this.options.bboxSR,imageSR:this.options.imageSR};return this.options.dynamicLayers&&(b.dynamicLayers=this.options.dynamicLayers),this.options.layers&&(b.layers="show:"+this.options.layers.join(",")),this.options.layerDefs&&
(b.layerDefs=JSON.stringify(this.options.layerDefs)),this.options.timeOptions&&(b.timeOptions=JSON.stringify(this.options.timeOptions)),this.options.from&&this.options.to&&(b.time=this.options.from.valueOf()+","+this.options.to.valueOf()),this._service.options.token&&(b.token=this._service.options.token),b},_requestExport:function(a,b){"json"===this.options.f?this._service.request("export",a,function(a,f){a||this._renderImage(f.href,b)},this):(a.f="image",this._renderImage(this.options.url+"export"+
d.Util.getParamString(a),b))}});e.DynamicMapLayer=e.Layers.DynamicMapLayer;e.Layers.dynamicMapLayer=function(a){return new e.Layers.DynamicMapLayer(a)};e.dynamicMapLayer=function(a){return new e.Layers.DynamicMapLayer(a)};e.Layers.ImageMapLayer=e.Layers.RasterLayer.extend({options:{updateInterval:150,format:"jpgpng",transparent:!0,f:"json"},query:function(){return this._service.query()},identify:function(){return this._service.identify()},initialize:function(a){a.url=e.Util.cleanUrl(a.url);this._service=
new e.Services.ImageService(a);this._service.on("authenticationrequired requeststart requestend requesterror requestsuccess",this._propagateEvent,this);d.Util.setOptions(this,a)},setPixelType:function(a){return this.options.pixelType=a,this._update(),this},getPixelType:function(){return this.options.pixelType},setBandIds:function(a){return d.Util.isArray(a)?this.options.bandIds=a.join(","):this.options.bandIds=a.toString(),this._update(),this},getBandIds:function(){return this.options.bandIds},setNoData:function(a,
b){return d.Util.isArray(a)?this.options.noData=a.join(","):this.options.noData=a.toString(),b&&(this.options.noDataInterpretation=b),this._update(),this},getNoData:function(){return this.options.noData},getNoDataInterpretation:function(){return this.options.noDataInterpretation},setRenderingRule:function(a){this.options.renderingRule=a;this._update()},getRenderingRule:function(){return this.options.renderingRule},setMosaicRule:function(a){this.options.mosaicRule=a;this._update()},getMosaicRule:function(){return this.options.mosaicRule},
_getPopupData:function(a){var b=d.Util.bind(function(c,b,e){c||setTimeout(d.Util.bind(function(){this._renderPopup(a.latlng,c,b,e)},this),300)},this),c=this.identify().at(a.latlng);this.options.mosaicRule&&c.setMosaicRule(this.options.mosaicRule);c.run(b);this._shouldRenderPopup=!0;this._lastClick=a.latlng},_buildExportParams:function(){var a=this._map.getBounds(),b=this._map.getSize(),c=this._map.options.crs.project(a._northEast),a=this._map.options.crs.project(a._southWest),b={bbox:[a.x,a.y,c.x,
c.y].join(),size:b.x+","+b.y,format:this.options.format,transparent:this.options.transparent,bboxSR:this.options.bboxSR,imageSR:this.options.imageSR};return this.options.from&&this.options.to&&(b.time=this.options.from.valueOf()+","+this.options.to.valueOf()),this.options.pixelType&&(b.pixelType=this.options.pixelType),this.options.interpolation&&(b.interpolation=this.options.interpolation),this.options.compressionQuality&&(b.compressionQuality=this.options.compressionQuality),this.options.bandIds&&
(b.bandIds=this.options.bandIds),this.options.noData&&(b.noData=this.options.noData),this.options.noDataInterpretation&&(b.noDataInterpretation=this.options.noDataInterpretation),this._service.options.token&&(b.token=this._service.options.token),this.options.renderingRule&&(b.renderingRule=JSON.stringify(this.options.renderingRule)),this.options.mosaicRule&&(b.mosaicRule=JSON.stringify(this.options.mosaicRule)),b},_requestExport:function(a,b){"json"===this.options.f?this._service.request("exportImage",
a,function(a,f){a||this._renderImage(f.href,b)},this):(a.f="image",this._renderImage(this.options.url+"exportImage"+d.Util.getParamString(a),b))}});e.ImageMapLayer=e.Layers.ImageMapLayer;e.Layers.imageMapLayer=function(a){return new e.Layers.ImageMapLayer(a)};e.imageMapLayer=function(a){return new e.Layers.ImageMapLayer(a)};e.Layers.TiledMapLayer=d.TileLayer.extend({options:{zoomOffsetAllowance:.1,correctZoomLevels:!0},statics:{MercatorZoomLevels:{0:156543.033928,1:78271.5169639999,2:39135.7584820001,
3:19567.8792409999,4:9783.93962049996,5:4891.96981024998,6:2445.98490512499,7:1222.99245256249,8:611.49622628138,9:305.748113140558,10:152.874056570411,11:76.4370282850732,12:38.2185141425366,13:19.1092570712683,14:9.55462853563415,15:4.77731426794937,16:2.38865713397468,17:1.19432856685505,18:.597164283559817,19:.298582141647617,20:.14929107082381,21:.07464553541191,22:.0373227677059525,23:.0186613838529763}},initialize:function(a){a.url=e.Util.cleanUrl(a.url);a=d.Util.setOptions(this,a);this.tileUrl=
d.esri.Util.cleanUrl(a.url)+"tile/{z}/{y}/{x}";this._service=new d.esri.Services.MapService(a);this._service.on("authenticationrequired requeststart requestend requesterror requestsuccess",this._propagateEvent,this);this.tileUrl.match("://tiles.arcgisonline.com")&&(this.tileUrl=this.tileUrl.replace("://tiles.arcgisonline.com","://tiles{s}.arcgisonline.com"),a.subdomains=["1","2","3","4"]);this.options.token&&(this.tileUrl+="?token="+this.options.token);d.TileLayer.prototype.initialize.call(this,this.tileUrl,
a)},getTileUrl:function(a){return d.Util.template(this.tileUrl,d.extend({s:this._getSubdomain(a),z:this._lodMap[a.z]||a.z,x:a.x,y:a.y},this.options))},onAdd:function(a){!this._lodMap&&this.options.correctZoomLevels?(this._lodMap={},this.metadata(function(b,c){if(!b){var f=c.spatialReference.latestWkid||c.spatialReference.wkid;if(102100===f||3857===f)for(var f=c.tileInfo.lods,k=e.Layers.TiledMapLayer.MercatorZoomLevels,g=0;g<f.length;g++){var h=f[g],l;for(l in k)if(this._withinPercentage(h.resolution,
k[l],this.options.zoomOffsetAllowance)){this._lodMap[l]=h.level;break}}else e.Util.warn("L.esri.TiledMapLayer is using a non-mercator spatial reference. Support may be available through Proj4Leaflet http://esri.github.io/esri-leaflet/examples/non-mercator-projection.html")}d.TileLayer.prototype.onAdd.call(this,a)},this)):d.TileLayer.prototype.onAdd.call(this,a)},metadata:function(a,b){return this._service.metadata(a,b),this},identify:function(){return this._service.identify()},authenticate:function(a){var b=
"?token="+a;return this.tileUrl=this.options.token?this.tileUrl.replace(/\?token=(.+)/g,b):this.tileUrl+b,this.options.token=a,this._service.authenticate(a),this},_propagateEvent:function(a){a=d.extend({layer:a.target,target:this},a);this.fire(a.type,a)},_withinPercentage:function(a,b,c){a=Math.abs(a/b-1);return c>a}});d.esri.TiledMapLayer=d.esri.Layers.tiledMapLayer;d.esri.Layers.tiledMapLayer=function(a){return new d.esri.Layers.TiledMapLayer(a)};d.esri.tiledMapLayer=function(a){return new d.esri.Layers.TiledMapLayer(a)};
e.Layers.FeatureGrid=d.Class.extend({includes:d.Mixin.Events,options:{cellSize:512,updateInterval:150},initialize:function(a){d.setOptions(this,a)},onAdd:function(a){this._map=a;this._update=d.Util.limitExecByInterval(this._update,this.options.updateInterval,this);this._map.addEventListener(this.getEvents(),this);this._reset();this._update()},onRemove:function(){this._map.removeEventListener(this.getEvents(),this);this._removeCells()},getEvents:function(){return{viewreset:this._reset,moveend:this._update,
zoomend:this._onZoom}},addTo:function(a){return a.addLayer(this),this},removeFrom:function(a){return a.removeLayer(this),this},_onZoom:function(){var a=this._map.getZoom();a>this.options.maxZoom||a<this.options.minZoom?(this.removeFrom(this._map),this._map.addEventListener("zoomend",this.getEvents().zoomend,this)):this._map.hasLayer(this)||(this._map.removeEventListener("zoomend",this.getEvents().zoomend,this),this.addTo(this._map))},_reset:function(){this._removeCells();this._cells={};this._activeCells=
{};this._cellsTotal=this._cellsToLoad=0;this._resetWrap()},_resetWrap:function(){var a=this._map,b=a.options.crs;if(!b.infinite){var c=this._getCellSize();b.wrapLng&&(this._wrapLng=[Math.floor(a.project([0,b.wrapLng[0]]).x/c),Math.ceil(a.project([0,b.wrapLng[1]]).x/c)]);b.wrapLat&&(this._wrapLat=[Math.floor(a.project([b.wrapLat[0],0]).y/c),Math.ceil(a.project([b.wrapLat[1],0]).y/c)])}},_getCellSize:function(){return this.options.cellSize},_update:function(){if(this._map){var a=this._map.getPixelBounds(),
b=this._map.getZoom(),c=this._getCellSize(),f=[c/2,c/2];b>this.options.maxZoom||b<this.options.minZoom||(b=a.min.subtract(f).divideBy(c).floor(),b.x=Math.max(b.x,0),b.y=Math.max(b.y,0),a=d.bounds(b,a.max.add(f).divideBy(c).floor()),this._removeOtherCells(a),this._addCells(a))}},_addCells:function(a){var b,c,f,e=[],g=a.getCenter(),h=this._map.getZoom();for(b=a.min.y;b<=a.max.y;b++)for(c=a.min.x;c<=a.max.x;c++)f=new d.Point(c,b),f.z=h,e.push(f);a=e.length;if(0!==a)for(this._cellsToLoad+=a,this._cellsTotal+=
a,e.sort(function(a,c){return a.distanceTo(g)-c.distanceTo(g)}),c=0;a>c;c++)this._addCell(e[c])},_cellCoordsToBounds:function(a){var b=this._map,c=this.options.cellSize,f=a.multiplyBy(c),c=f.add([c,c]),f=b.unproject(f,a.z).wrap();a=b.unproject(c,a.z).wrap();return new d.LatLngBounds(f,a)},_cellCoordsToKey:function(a){return a.x+":"+a.y},_keyToCellCoords:function(a){var b=a.split(":");a=parseInt(b[0],10);b=parseInt(b[1],10);return new d.Point(a,b)},_removeOtherCells:function(a){for(var b in this._cells)a.contains(this._keyToCellCoords(b))||
this._removeCell(b)},_removeCell:function(a){var b=this._activeCells[a];b&&(delete this._activeCells[a],this.cellLeave&&this.cellLeave(b.bounds,b.coords),this.fire("cellleave",{bounds:b.bounds,coords:b.coords}))},_removeCells:function(){for(var a in this._cells){var b=this._cells[a].bounds,c=this._cells[a].coords;this.cellLeave&&this.cellLeave(b,c);this.fire("cellleave",{bounds:b,coords:c})}},_addCell:function(a){this._wrapCoords(a);var b=this._cellCoordsToKey(a),c=this._cells[b];c&&!this._activeCells[b]&&
(this.cellEnter&&this.cellEnter(c.bounds,a),this.fire("cellenter",{bounds:c.bounds,coords:a}),this._activeCells[b]=c);c||(c={coords:a,bounds:this._cellCoordsToBounds(a)},this._cells[b]=c,this._activeCells[b]=c,this.createCell&&this.createCell(c.bounds,a),this.fire("cellcreate",{bounds:c.bounds,coords:a}))},_wrapCoords:function(a){a.x=this._wrapLng?d.Util.wrapNum(a.x,this._wrapLng):a.x;a.y=this._wrapLat?d.Util.wrapNum(a.y,this._wrapLat):a.y}});(function(a){function b(a){this.values=a||[]}a.Layers.FeatureManager=
a.Layers.FeatureGrid.extend({options:{where:"1=1",fields:["*"],from:!1,to:!1,timeField:!1,timeFilterMode:"server",simplifyFactor:0,precision:6},initialize:function(c){if(a.Layers.FeatureGrid.prototype.initialize.call(this,c),c.url=a.Util.cleanUrl(c.url),c=d.setOptions(this,c),this._service=new a.Services.FeatureLayerService(c),"*"!==this.options.fields[0]){c=!1;for(var f=0;f<this.options.fields.length;f++)this.options.fields[f].match(/^(OBJECTID|FID|OID|ID)$/i)&&(c=!0);!1===c&&a.Util.warn("no known esriFieldTypeOID field detected in fields Array.  Please add an attribute field containing unique IDs to ensure the layer can be drawn correctly.")}this._service.on("authenticationrequired requeststart requestend requesterror requestsuccess",
function(a){a=d.extend({target:this},a);this.fire(a.type,a)},this);this.options.timeField.start&&this.options.timeField.end?(this._startTimeIndex=new b,this._endTimeIndex=new b):this.options.timeField&&(this._timeIndex=new b);this._cache={};this._currentSnapshot=[];this._activeRequests=0;this._pendingRequests=[]},onAdd:function(c){return a.Layers.FeatureGrid.prototype.onAdd.call(this,c)},onRemove:function(c){return a.Layers.FeatureGrid.prototype.onRemove.call(this,c)},getAttribution:function(){return this.options.attribution},
createCell:function(a,b){this._requestFeatures(a,b)},_requestFeatures:function(c,b,e){this._activeRequests++;1===this._activeRequests&&this.fire("loading",{bounds:c});this._buildQuery(c).run(function(g,h,l){l&&l.exceededTransferLimit&&this.fire("drawlimitexceeded");!g&&h&&h.features.length&&a.Util.requestAnimationFrame(d.Util.bind(function(){this._addFeatures(h.features,b);this._postProcessFeatures(c)},this));g||!h||h.features.length||this._postProcessFeatures(c);e&&e.call(this,g,h)},this)},_postProcessFeatures:function(a){this._activeRequests--;
0>=this._activeRequests&&this.fire("load",{bounds:a})},_cacheKey:function(a){return a.z+":"+a.x+":"+a.y},_addFeatures:function(a,b){var d=this._cacheKey(b);this._cache[d]=this._cache[d]||[];for(var e=a.length-1;0<=e;e--){var h=a[e].id;this._currentSnapshot.push(h);this._cache[d].push(h)}this.options.timeField&&this._buildTimeIndexes(a);d=this._map.getZoom();d>this.options.maxZoom||d<this.options.minZoom||this.createLayers(a)},_buildQuery:function(a){a=this._service.query().intersects(a).where(this.options.where).fields(this.options.fields).precision(this.options.precision);
return this.options.simplifyFactor&&a.simplify(this._map,this.options.simplifyFactor),"server"===this.options.timeFilterMode&&this.options.from&&this.options.to&&a.between(this.options.from,this.options.to),a},setWhere:function(b,f,e){this.options.where=b&&b.length?b:"1=1";var g=[],h=[],l=0,m=null;b=d.Util.bind(function(b,c){if(l--,b&&(m=b),c)for(var n=c.features.length-1;0<=n;n--)h.push(c.features[n].id);0>=l&&(this._currentSnapshot=h,a.Util.requestAnimationFrame(d.Util.bind(function(){this.removeLayers(g);
this.addLayers(h);f&&f.call(e,m)},this)))},this);for(var n=this._currentSnapshot.length-1;0<=n;n--)g.push(this._currentSnapshot[n]);for(var u in this._activeCells)l++,n=this._keyToCellCoords(u),n=this._cellCoordsToBounds(n),this._requestFeatures(n,u,b);return this},getWhere:function(){return this.options.where},getTimeRange:function(){return[this.options.from,this.options.to]},setTimeRange:function(a,b,e,g){var h=this.options.from,l=this.options.to,m=0,n=null,u=d.Util.bind(function(d){d&&(n=d);this._filterExistingFeatures(h,
l,a,b);m--;e&&0>=m&&e.call(g,n)},this);if(this.options.from=a,this.options.to=b,this._filterExistingFeatures(h,l,a,b),"server"===this.options.timeFilterMode)for(var x in this._activeCells){m++;var q=this._keyToCellCoords(x),q=this._cellCoordsToBounds(q);this._requestFeatures(q,x,u)}},refresh:function(){for(var a in this._activeCells){var b=this._keyToCellCoords(a),b=this._cellCoordsToBounds(b);this._requestFeatures(b,a)}this.redraw&&this.once("load",function(){this.eachFeature(function(a){this._redraw(a.feature.id)},
this)},this)},_filterExistingFeatures:function(b,f,e,g){var h=b&&f?this._getFeaturesInTimeRange(b,f):this._currentSnapshot,l=this._getFeaturesInTimeRange(e,g);if(l.indexOf)for(b=0;b<l.length;b++)f=h.indexOf(l[b]),0<=f&&h.splice(f,1);a.Util.requestAnimationFrame(d.Util.bind(function(){this.removeLayers(h);this.addLayers(l)},this))},_getFeaturesInTimeRange:function(a,b){var d,e=[];if(this.options.timeField.start&&this.options.timeField.end){d=this._startTimeIndex.between(a,b);var h=this._endTimeIndex.between(a,
b);d=d.concat(h)}else d=this._timeIndex.between(a,b);for(h=d.length-1;0<=h;h--)e.push(d[h].id);return e},_buildTimeIndexes:function(a){var b,d;if(this.options.timeField.start&&this.options.timeField.end){var e=[],h=[];for(b=a.length-1;0<=b;b--)d=a[b],e.push({id:d.id,value:new Date(d.properties[this.options.timeField.start])}),h.push({id:d.id,value:new Date(d.properties[this.options.timeField.end])});this._startTimeIndex.bulkAdd(e);this._endTimeIndex.bulkAdd(h)}else{e=[];for(b=a.length-1;0<=b;b--)d=
a[b],e.push({id:d.id,value:new Date(d.properties[this.options.timeField])});this._timeIndex.bulkAdd(e)}},_featureWithinTimeRange:function(a){if(!this.options.from||!this.options.to)return!0;var b=+this.options.from.valueOf(),d=+this.options.to.valueOf();if("string"==typeof this.options.timeField){var e=+a.properties[this.options.timeField];return e>=b&&d>=e}if(this.options.timeField.start&&this.options.timeField.end)return e=+a.properties[this.options.timeField.start],a=+a.properties[this.options.timeField.end],
e>=b&&d>=e||a>=b&&d>=a},authenticate:function(a){return this._service.authenticate(a),this},metadata:function(a,b){return this._service.metadata(a,b),this},query:function(){return this._service.query()},_getMetadata:function(a){this._metadata?a(void 0,this._metadata):this.metadata(d.Util.bind(function(b,d){this._metadata=d;a(b,this._metadata)},this))},addFeature:function(a,b,e){this._getMetadata(d.Util.bind(function(g,h){this._service.addFeature(a,d.Util.bind(function(d,g){d||(a.properties[h.objectIdField]=
g.objectId,a.id=g.objectId,this.createLayers([a]));b&&b.call(e,d,g)},this))},this))},updateFeature:function(a,b,d){this._service.updateFeature(a,function(e,h){e||(this.removeLayers([a.id],!0),this.createLayers([a]));b&&b.call(d,e,h)},this)},deleteFeature:function(a,b,d){this._service.deleteFeature(a,function(a,c){!a&&c.objectId&&this.removeLayers([c.objectId],!0);b&&b.call(d,a,c)},this)},deleteFeatures:function(a,b,d){return this._service.deleteFeatures(a,function(a,c){if(!a&&0<c.length)for(var e=
0;e<c.length;e++)this.removeLayers([c[e].objectId],!0);b&&b.call(d,a,c)},this)}});b.prototype._query=function(a){for(var b,d,e=0,h=this.values.length-1;h>=e;)if(b=(e+h)/2|0,d=this.values[Math.round(b)],+d.value<+a)e=b+1;else{if(!(+d.value>+a))return b;h=b-1}return~h};b.prototype.sort=function(){this.values.sort(function(a,b){return+b.value-+a.value}).reverse();this.dirty=!1};b.prototype.between=function(a,b){this.dirty&&this.sort();var d=this._query(a),e=this._query(b);return 0===d&&0===e?[]:(d=Math.abs(d),
e=0>e?Math.abs(e):e+1,this.values.slice(d,e))};b.prototype.bulkAdd=function(a){this.dirty=!0;this.values=this.values.concat(a)}})(e);e.Layers.FeatureLayer=e.Layers.FeatureManager.extend({statics:{EVENTS:"click dblclick mouseover mouseout mousemove contextmenu popupopen popupclose"},options:{cacheLayers:!0},initialize:function(a){e.Layers.FeatureManager.prototype.initialize.call(this,a);d.setOptions(this,a);this._layers={};this._leafletIds={};this._key="c"+(1E9*Math.random()).toString(36).replace(".",
"_")},onAdd:function(a){return a.on("zoomstart zoomend",function(a){this._zooming="zoomstart"===a.type},this),e.Layers.FeatureManager.prototype.onAdd.call(this,a)},onRemove:function(a){for(var b in this._layers)a.removeLayer(this._layers[b]);return e.Layers.FeatureManager.prototype.onRemove.call(this,a)},createNewLayer:function(a){return d.GeoJSON.geometryToLayer(a,this.options.pointToLayer,d.GeoJSON.coordsToLatLng,this.options)},_updateLayer:function(a,b){var c=[],c=this.options.coordsToLatLng||
d.GeoJSON.coordsToLatLng;switch(b.properties&&(a.feature.properties=b.properties),b.geometry.type){case "Point":c=d.GeoJSON.coordsToLatLng(b.geometry.coordinates);a.setLatLng(c);break;case "LineString":c=d.GeoJSON.coordsToLatLngs(b.geometry.coordinates,0,c);a.setLatLngs(c);break;case "MultiLineString":c=d.GeoJSON.coordsToLatLngs(b.geometry.coordinates,1,c);a.setLatLngs(c);break;case "Polygon":c=d.GeoJSON.coordsToLatLngs(b.geometry.coordinates,1,c);a.setLatLngs(c);break;case "MultiPolygon":c=d.GeoJSON.coordsToLatLngs(b.geometry.coordinates,
2,c),a.setLatLngs(c)}},createLayers:function(a){for(var b=a.length-1;0<=b;b--){var c,d=a[b],k=this._layers[d.id];k&&!this._map.hasLayer(k)&&this._map.addLayer(k);k&&(k.setLatLngs||k.setLatLng)&&this._updateLayer(k,d);k||(c=this.createNewLayer(d),c.feature=d,this.options.style?c._originalStyle=this.options.style:c.setStyle&&(c._originalStyle=c.options),c._leaflet_id=this._key+"_"+d.id,this._leafletIds[c._leaflet_id]=d.id,c.on(e.Layers.FeatureLayer.EVENTS,this._propagateEvent,this),this._popup&&c.bindPopup&&
c.bindPopup(this._popup(c.feature,c),this._popupOptions),this.options.onEachFeature&&this.options.onEachFeature(c.feature,c),this._layers[c.feature.id]=c,this.resetStyle(c.feature.id),this.fire("createfeature",{feature:c.feature}),(!this.options.timeField||this.options.timeField&&this._featureWithinTimeRange(d))&&this._map.addLayer(c))}},addLayers:function(a){for(var b=a.length-1;0<=b;b--){var c=this._layers[a[b]];c&&(this.fire("addfeature",{feature:c.feature}),this._map.addLayer(c))}},removeLayers:function(a,
b){for(var c=a.length-1;0<=c;c--){var d=a[c],e=this._layers[d];e&&(this.fire("removefeature",{feature:e.feature,permanent:b}),this._map.removeLayer(e));e&&b&&delete this._layers[d]}},cellEnter:function(a,b){this._zooming||e.Util.requestAnimationFrame(d.Util.bind(function(){var a=this._cacheKey(b),d=this._cellCoordsToKey(b),a=this._cache[a];this._activeCells[d]&&a&&this.addLayers(a)},this))},cellLeave:function(a,b){this._zooming||e.Util.requestAnimationFrame(d.Util.bind(function(){var a=this._cacheKey(b),
d=this._cellCoordsToKey(b),e=this._cache[a],g=this._map.getBounds();if(!this._activeCells[d]&&e){for(var h=!0,l=0;l<e.length;l++){var m=this._layers[e[l]];m&&m.getBounds&&g.intersects(m.getBounds())&&(h=!1)}h&&this.removeLayers(e,!this.options.cacheLayers);!this.options.cacheLayers&&h&&(delete this._cache[a],delete this._cells[d],delete this._activeCells[d])}},this))},resetStyle:function(a){a=this._layers[a];return a&&this.setFeatureStyle(a.feature.id,a._originalStyle),this},setStyle:function(a){return this.options.style=
a,this.eachFeature(function(b){this.setFeatureStyle(b.feature.id,a)},this),this},setFeatureStyle:function(a,b){var c=this._layers[a];return"function"==typeof b&&(b=b(c.feature)),b||c.defaultOptions||(b=d.Path.prototype.options,b.fill=!0),c&&c.setStyle&&c.setStyle(b),this},bindPopup:function(a,b){this._popup=a;this._popupOptions=b;for(var c in this._layers){var d=this._layers[c],e=this._popup(d.feature,d);d.bindPopup(e,b)}return this},unbindPopup:function(){this._popup=!1;for(var a in this._layers){var b=
this._layers[a];if(b.unbindPopup)b.unbindPopup();else if(b.getLayers){var b=b.getLayers(),c;for(c in b)b[c].unbindPopup()}}return this},eachFeature:function(a,b){for(var c in this._layers)a.call(b,this._layers[c]);return this},getFeature:function(a){return this._layers[a]},bringToBack:function(){this.eachFeature(function(a){a.bringToBack&&a.bringToBack()})},bringToFront:function(){this.eachFeature(function(a){a.bringToFront&&a.bringToFront()})},redraw:function(a){return a&&this._redraw(a),this},_redraw:function(a){a=
this._layers[a];var b=a.feature;if(a&&a.setIcon&&this.options.pointToLayer&&this.options.pointToLayer){var c=this.options.pointToLayer(b,d.latLng(b.geometry.coordinates[1],b.geometry.coordinates[0])).options.icon;a.setIcon(c)}a&&a.setStyle&&this.options.pointToLayer&&(c=this.options.pointToLayer(b,d.latLng(b.geometry.coordinates[1],b.geometry.coordinates[0])).options,this.setFeatureStyle(b.id,c));a&&a.setStyle&&this.options.style&&this.resetStyle(b.id)},_propagateEvent:function(a){a.layer=this._layers[this._leafletIds[a.target._leaflet_id]];
a.target=this;this.fire(a.type,a)}});e.FeatureLayer=e.Layers.FeatureLayer;e.Layers.featureLayer=function(a){return new e.Layers.FeatureLayer(a)};e.featureLayer=function(a){return new e.Layers.FeatureLayer(a)};e.Controls.Logo=d.Control.extend({options:{position:"bottomright",marginTop:0,marginLeft:0,marginBottom:0,marginRight:0},onAdd:function(){var a=d.DomUtil.create("div","esri-leaflet-logo");return a.style.marginTop=this.options.marginTop,a.style.marginLeft=this.options.marginLeft,a.style.marginBottom=
this.options.marginBottom,a.style.marginRight=this.options.marginRight,a.innerHTML=this._adjustLogo(this._map._size),this._map.on("resize",function(b){a.innerHTML=this._adjustLogo(b.newSize)},this),a},_adjustLogo:function(a){return 600>=a.x||600>=a.y?'<a href="https://developers.arcgis.com" style="border: none;"><img src="https://js.arcgis.com/3.13/esri/images/map/logo-sm.png" alt="Powered by Esri" style="border: none;"></a>':'<a href="https://developers.arcgis.com" style="border: none;"><img src="https://js.arcgis.com/3.13/esri/images/map/logo-med.png" alt="Powered by Esri" style="border: none;"></a>'}});
e.Controls.logo=function(a){return new d.esri.Controls.Logo(a)};return e});